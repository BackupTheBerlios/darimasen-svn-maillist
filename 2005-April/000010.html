<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Darimasen-svn] r57 - trunk/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/darimasen-svn/2005-April/index.html" >
   <LINK REL="made" HREF="mailto:darimasen-svn%40lists.berlios.de?Subject=Re%3A%20%5BDarimasen-svn%5D%20r57%20-%20trunk/src&In-Reply-To=%3C200504201532.j3KFWhcX017595%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000009.html">
   <LINK REL="Next"  HREF="000011.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Darimasen-svn] r57 - trunk/src</H1>
    <B>darimasen-svn-admin at lists.berlios.de</B> 
    <A HREF="mailto:darimasen-svn%40lists.berlios.de?Subject=Re%3A%20%5BDarimasen-svn%5D%20r57%20-%20trunk/src&In-Reply-To=%3C200504201532.j3KFWhcX017595%40sheep.berlios.de%3E"
       TITLE="[Darimasen-svn] r57 - trunk/src">darimasen-svn-admin at lists.berlios.de
       </A><BR>
    <I>Wed Apr 20 17:32:43 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000009.html">[Darimasen-svn] r56 - trunk/src
</A></li>
        <LI>Next message: <A HREF="000011.html">[Darimasen-svn] r58 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10">[ date ]</a>
              <a href="thread.html#10">[ thread ]</a>
              <a href="subject.html#10">[ subject ]</a>
              <a href="author.html#10">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: sudrien
Date: 2005-04-20 17:32:37 +0200 (Wed, 20 Apr 2005)
New Revision: 57

Modified:
   trunk/src/iconmodes.cpp
   trunk/src/iconmodes.h
Log:
iconmodes rebuild in progress

Modified: trunk/src/iconmodes.cpp
===================================================================
--- trunk/src/iconmodes.cpp	2005-04-19 18:26:51 UTC (rev 56)
+++ trunk/src/iconmodes.cpp	2005-04-20 15:32:37 UTC (rev 57)
@@ -1,873 +1,88 @@
 /* Darimasen - iconmodes.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
 
-#include &quot;iconmodes.h&quot;
-#include &lt;iostream&gt;
-
-/**********************/
-
-DaIconModes::DaIconModes(guint pos, Darimasen&amp; myParent) {    
+#include &quot;iconmodes.h&quot;
 
-  parent = &myParent;
-
-position = pos;
-
-lastclick = 0;
-  filesAtPath = 0;
-  try{
-    Gnome::Vfs::DirectoryHandle handle;
-    handle.open((parent-&gt;history[position].top()), Gnome::Vfs::FILE_INFO_DEFAULT);
-    bool file_exists = true;
-    while(file_exists){
-      handle.read_next(file_exists);
-      filesAtPath++;
-      }
-    }
-  catch(const Gnome::Vfs::exception&amp;){std::cout &lt;&lt; &quot;Miscount?\n&quot;;}
-
-
- // iconmode = 0;
-
-  slotsUsed = 0;
-  IconsHigh = 0;
-  set_visible_window(false);
-  hidden = new int[filesAtPath];
-
-  if(parent-&gt;get_mode() == 0){
-    sideconContainer = new Gtk::EventBox*[filesAtPath];
-    for(int c = 0; c &lt; filesAtPath; c++){
-      sideconContainer[c] = new Gtk::EventBox;
-      }
-
-    try {
-        // Call on_visit() for each file.
-        // The options specify that we want to visit the files at input_uri_string,
-        // get the mime type the fast way and protect against loops.
-      Gnome::Vfs::DirectoryHandle::visit( parent-&gt;history[position].top(), Gnome::Vfs::FILE_INFO_GET_MIME_TYPE |
-                                             Gnome::Vfs::FILE_INFO_FORCE_FAST_MIME_TYPE |
-                                             Gnome::Vfs::FILE_INFO_FOLLOW_LINKS ,
-                                             Gnome::Vfs::DIRECTORY_VISIT_LOOPCHECK,
-                                             sigc::mem_fun(*this,&amp;DaIconModes::addEntry));
-      }
-    catch(const Gnome::Vfs::exception&amp; ex){/*this is required.*/}
-    }      
-
-
-
-  }
-
 /**********************/
 
-DaIconModes::~DaIconModes(){
+DaIconModes::proto_icon::proto_icon(
+      DaIconModes&amp; getParent,
+      Glib::ustring getPath,
+      const Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt; getFile) {
 
-  // cleanup on aisles 1, 2, 3 ... and so on.
-// there is an issue that this could be deleting while in the wrong mode - yeah.
-  if(parent-&gt;get_mode() == 0 ){
-    for(int c = 0; c &lt; filesAtPath; c++){
-      Gtk::Widget * tmp = sideconContainer[c]-&gt;get_child();
-      if (tmp)
-        delete tmp;
-        }
+  path = getPath;
  parent = &getParent;
 
-    for(int c = 0; c &lt; filesAtPath; c++){
-      delete sideconContainer[c];
-      }
-    delete sideconContainer;
-    delete hidden;
-  }
-}
-/**********************/
 
-bool DaIconModes::addEntry(
-    Glib::ustring rel_path,
-    Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt; info,
-    bool recursing_will_loop,
-    bool recurse) {
+  icon = parent-&gt;getIcon(getFile-&gt;get_mime_type());
 
-  if (info-&gt;get_type() != Gnome::Vfs::FILE_TYPE_DIRECTORY){
-      sideconContainer[slotsUsed]-&gt;set_visible_window(false);
-      sideconContainer[slotsUsed]-&gt;show();
 
-hidden[slotsUsed] = (info-&gt;get_name().substr(0,1) == &quot;.&quot;);
+  FileName = new Gtk::Label(getFile-&gt;get_name());
+  FileName-&gt;set_alignment(0,0.5);
+  FileName-&gt;show();
 
-switch(parent-&gt;get_mode()){
-case 0: {
-Sidecon * tempPathS = new Sidecon( parent-&gt;history[position].top(), info, *this);
-      tempPathS-&gt;show();
-      sideconContainer[slotsUsed]-&gt;add(*tempPathS);
-	}
-break;
-case 1: {
-//Detail * tempPathD = new Detail(fullPath, info); 
-//      tempPathD-&gt;show();
-//     sideconContainer[slotsUsed]-&gt;add(*tempPathD);
-	}
-break;
-}
-
-
-      sideconContainer[slotsUsed]-&gt;set_events(Gdk::BUTTON_RELEASE_MASK);
-      sideconContainer[slotsUsed]-&gt;signal_button_press_event().connect(
-        sigc::bind&lt;Glib::ustring &gt;(
-          sigc::mem_fun(*this, &amp;DaIconModes::on_eventbox_button_press), info-&gt;get_name() ));
-      slotsUsed++;
-    }
-  recurse = false; 
-  return true;
-  }
-
-/**********************/
-
-DaIconModes::Sidecon::Sidecon(
-      Glib::ustring path,
-      const Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt;&amp; info,
-      DaIconModes&amp; above){
-
-  parent = &above;
-  filePath = path + info-&gt;get_name();
-
-  if (info-&gt;get_name().length() &gt; 25){
-    int last = info-&gt;get_name().rfind(&quot;.&quot;);
+  if (getFile-&gt;get_name().length() &gt; 25){
+    int last = getFile-&gt;get_name().rfind(&quot;.&quot;);
     if (last != -1){
-      FileName = new class Gtk::Label( info-&gt;get_name().substr(0, 20) + &quot;..&quot; + info-&gt;get_name().substr(last) );
+      ShortFileName = new Gtk::Label(
+        getFile-&gt;get_name().substr(0, 20) + &quot;..&quot; + getFile-&gt;get_name().substr(last) );
       }
     else {
-      FileName = new class Gtk::Label( info-&gt;get_name().substr(0,22) + &quot;...&quot; );
+      ShortFileName = new Gtk::Label(getFile-&gt;get_name().substr(0,22) + &quot;...&quot; );
       }
     }
   else {
-  FileName = new class Gtk::Label( info-&gt;get_name() );
-  }
-                   
-
-
-//  FileName = new class Gtk::Label(shortnom);
-  FileName-&gt;set_alignment(0,0.5);
-  FileName-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-  attach(*FileName, 1, 2, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
-
-
-  // hand off getting the icon
-  image1 = new class Gtk::Image(parent-&gt;getIcon(info-&gt;get_mime_type(), 48));
-  attach(*image1, 0, 1, 0, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-
-
-  // this is where the mimetype info goes
-  FilePermissions = new class Gtk::Label(info-&gt;get_mime_type());
-  FilePermissions-&gt;set_alignment(0,0.5);
-  FilePermissions-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-  attach(*FilePermissions, 1, 2, 1, 2, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
-
-
-  // This is simply file size - images an video could have more. Later.
-  if( info-&gt;get_size() &lt; 1024 ){
-    FileSizeInfo = new class Gtk::Label(int2ustr(info-&gt;get_size()) + &quot; B&quot;);
-    }
-  else if ( info-&gt;get_size() &lt; (1024 * 1024) ){
-    FileSizeInfo = new class Gtk::Label(int2ustr(info-&gt;get_size() / 1024) + &quot; KB&quot;);
-    }
-  else{
-    FileSizeInfo = new class Gtk::Label( int2ustr(info-&gt;get_size() / 1048576) + &quot; MB&quot;);
-    }
-  FileSizeInfo-&gt;set_alignment(0,0.5);
-  FileSizeInfo-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-  attach(*FileSizeInfo, 1, 2, 2, 3, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
-
-
-  show_all_children();
  }
-
-/**********************
-
-DaIconModes::Detail::Detail(
-    Glib::ustring path,
-    const Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt;&amp; info){
-
-
-  filePath = path + info-&gt;get_name();
-
-  Glib::ustring shortnom = info-&gt;get_name();
-
-  if (info-&gt;get_name().length() &gt; 25){
-
-    int last = info-&gt;get_name().rfind(&quot;.&quot;);
-
-    if (last != -1){ //fix for the missing extension bug
-      Glib::ustring ext = info-&gt;get_name().substr(last);  
-      shortnom = info-&gt;get_name().substr(0, 20) + &quot;..&quot; + ext;
-      }
-    else {
-      shortnom = info-&gt;get_name().substr(0,22) + &quot;...&quot;;
-      }
-
-    }
-                   
-  resize(1,3);
-  //Gtk::Image * image1 = Gtk::manage(new class Gtk::Image(Gtk::StockID(&quot;gtk-dnd&quot;), Gtk::IconSize(6)));
-  Gtk::Label * FileName = Gtk::manage(new class Gtk::Label(shortnom));
-
-  // this is where the mimetype info goes
-  mimeInfo = info-&gt;get_mime_type();
-  Gtk::Label * FilePermissions = Gtk::manage( new class Gtk::Label(mimeInfo));
-
-  // THis is simply file size - images an video could have more. Much later.
-  Glib::ustring size;
-  if( info-&gt;get_size() &lt; 1024 ){
-    size = int2ustr(info-&gt;get_size()) + &quot; B&quot;;
-    }
-  else if ( info-&gt;get_size() &lt; (1024 * 1024) ){
-    size = int2ustr(info-&gt;get_size() / 1024) + &quot; KB&quot;;
-    }
-  else{
-    size = int2ustr(info-&gt;get_size() / 1024 / 1024) + &quot; MB&quot;;  std::cout &lt;&lt; &quot;2\n&quot;;
-    }
-
-  // ideally, this label would be 80% size of standard
-  Gtk::Label * FileSizeInfo = Gtk::manage( new class Gtk::Label(size));
-
-  FileName-&gt;set_alignment(0,0.5);
-  FileName-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-  FilePermissions-&gt;set_alignment(0,0.5);
-  FilePermissions-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-  FileSizeInfo-&gt;set_alignment(0,0.5);
-  FileSizeInfo-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-  
-  //attach(*image1, 0, 1, 0, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-  attach(*FileName, 0, 1, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
-  attach(*FilePermissions, 1, 2, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
-  attach(*FileSizeInfo, 2, 3, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
-  
-  //image1-&gt;show();
-  FileName-&gt;show();
-  FilePermissions-&gt;show();
-  FileSizeInfo-&gt;show();
-  show();
  }
-
-/**********************/
-
-
-void DaIconModes::RunFile(const Glib::ustring file) {
-
-  // see if the file is executable 
-
-  Gnome::Vfs::Handle read_handle;
-  Gnome::Vfs::Handle exec_handle;
-  Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt; info;
-  
-  try{
-    read_handle.open( parent-&gt;history[position].top() + file, Gnome::Vfs::OPEN_READ);
-    info = read_handle.get_file_info(
-      Gnome::Vfs::FILE_INFO_GET_MIME_TYPE |
-      Gnome::Vfs::FILE_INFO_FORCE_SLOW_MIME_TYPE );
-    }
-  catch(const Gnome::Vfs::exception&amp; ex){
-    std::cout &lt;&lt; &quot;Does not exist.\n&quot;;
-    return;
-    }
-
-
-  Glib::ustring exec = getenv(&quot;HOME&quot;);
-  try{
-    exec += &quot;/Choices/MIME-types/&quot;;
-    exec += info-&gt;get_mime_type().replace(info-&gt;get_mime_type().find(&quot;/&quot;),1,&quot;_&quot;);
-    exec_handle.open(exec, Gnome::Vfs::OPEN_READ);
-
-    exec += &quot; \&quot;&quot;  + parent-&gt;history[position].top() + file + &quot;\&quot;&quot;;
-    Glib::spawn_command_line_async(exec);
-
-    parent-&gt;set_message(exec + &quot; was run.&quot;);
-    return;
-
-    }
-  catch(const Gnome::Vfs::exception&amp; ex){
-    }
-
-
-  try{
-    exec = exec.substr(0, exec.rfind(&quot;_&quot;));
-    exec_handle.open(exec, Gnome::Vfs::OPEN_READ);
-    exec += &quot; \&quot;&quot;  + parent-&gt;history[position].top() + file + &quot;\&quot;&quot;;
-    Glib::spawn_command_line_async(exec);
-
-    parent-&gt;set_message(exec + &quot; was run.&quot;);
-    return;
-    }
-  catch(const Gnome::Vfs::exception&amp; ex){
-    }
-
-  if (Gnome::Vfs::Mime::can_be_executable(info-&gt;get_mime_type())){
-    parent-&gt;set_message( &quot;Running &quot; + parent-&gt;history[position].top()  + file);
-    Glib::spawn_command_line_async( parent-&gt;history[position].top()  + file);
-    return;
-    }
-  else {
-    }
-    
-
-  Gtk::MessageDialog dialog(
-    &quot;This mimetype does not have any action associated with it.\n&quot;
-    &quot;should it be opened as text?&quot;,
-    false, Gtk::MESSAGE_ERROR, Gtk::BUTTONS_OK_CANCEL);
-
-
-  //Handle the response:
-  switch(dialog.run())
-  {
-    case(Gtk::RESPONSE_OK):
-    {
-      Glib::ustring exec = getenv(&quot;HOME&quot;);
-      exec += &quot;/Choices/MIME-types/text_plain&quot;;
-      exec += &quot; \&quot;&quot;  + parent-&gt;history[position].top()  + file + &quot;\&quot;&quot;;
-      Glib::spawn_command_line_async(exec);
-    parent-&gt;set_message(exec + &quot; was opened as a text file.&quot;);
-      return;
-      break;
-    }
-    default:
-    {
-    parent-&gt;set_message(&quot;Well, that was usefull.&quot;);
-      break;
-    }
+  ShortFileName = new Gtk::Label(getFile-&gt;get_name() );
   }
+  ShortFileName-&gt;set_alignment(0,0.5);
 
-}
 
+  FileMime = new Gtk::Label(getFile-&gt;get_mime_type());
+  FileMime-&gt;set_alignment(0,0.5);
 
-
-/**********************/
 
+  guint size = getFile-&gt;get_size();
+  if(size &lt; 1024)
+    FileSize = new class Gtk::Label(int2ustr(size) + &quot; B&quot;);
+  else if (size &lt; 1048576)
+    FileSize = new class Gtk::Label(int2ustr(size / 1024) + &quot; KB&quot;);
+  else
+    FileSize = new class Gtk::Label( int2ustr(size / 1048576) + &quot; MB&quot;);
+  FileSize-&gt;set_alignment(0,0.5);
 
-void DaIconModes::RunFileAsText(const Glib::ustring file) {
+  hidden = (getFile-&gt;get_name().substr(0,1) == &quot;.&quot;);
 
-  // see if the file is executable 
 
-  Gnome::Vfs::Handle read_handle;
-  Gnome::Vfs::Handle exec_handle;
-  Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt; info;
-  
-  try{
-    read_handle.open( parent-&gt;history[position].top() + file, Gnome::Vfs::OPEN_READ);
-    info = read_handle.get_file_info(
-      Gnome::Vfs::FILE_INFO_GET_MIME_TYPE |
-      Gnome::Vfs::FILE_INFO_FORCE_SLOW_MIME_TYPE );
-    }
-  catch(const Gnome::Vfs::exception&amp; ex){
-    std::cout &lt;&lt; &quot;Does not exist.\n&quot;;
-    return;
-    }
 
+  };
 
-  Glib::ustring exec = getenv(&quot;HOME&quot;);
-  try{
-    exec += &quot;/Choices/MIME-types/text&quot;;
-    exec_handle.open(exec, Gnome::Vfs::OPEN_READ);
-
-    exec += &quot; \&quot;&quot;  + parent-&gt;history[position].top() + file + &quot;\&quot;&quot;;
-    Glib::spawn_command_line_async(exec);
-
-    parent-&gt;set_message(exec + &quot; was run.&quot;);
-    return;
-
-    }
-  catch(const Gnome::Vfs::exception&amp; ex){
-    }
-
-}
-
-
-
 /**********************/
 
-void DaIconModes::SetRunAction(const Glib::ustring file) {
 
-  Gnome::Vfs::Handle read_handle;
-  Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt; info;
-  Glib::ustring exec_subtype;
-  Glib::ustring exec_mimetype;
-
-  try {
-    read_handle.open( parent-&gt;history[position].top() + file, Gnome::Vfs::OPEN_READ);
-    info = read_handle.get_file_info(
-        Gnome::Vfs::FILE_INFO_GET_MIME_TYPE |
-        Gnome::Vfs::FILE_INFO_FORCE_SLOW_MIME_TYPE );
-
-    exec_subtype  = info-&gt;get_mime_type();
-    exec_subtype  = exec_subtype.replace( exec_subtype.find(&quot;/&quot;), 1, &quot;_&quot; );
-    exec_mimetype = exec_subtype.substr( 0, exec_subtype.rfind(&quot;_&quot;) );
-
-    ChooseActionDialogue * chooseAction;
-    chooseAction = new ChooseActionDialogue(exec_subtype);
-    chooseAction-&gt;show();
-    }
-  catch(const Gnome::Vfs::exception&amp; ex) {
-    parent-&gt;set_message(&quot;Err... Setting error?&quot;);
-    }
+DaIconModes::proto_icon::~proto_icon(){
+  delete FileName;
+  delete FileMime;
+  delete FileSize;
+std::cout &lt;&lt; &quot;proto deleted&quot;;
   }
-
-/**********************/
 
-// make a generic icon action
-bool DaIconModes::on_eventbox_button_press(GdkEventButton* event, const Glib::ustring Icon){
-
-  if ((event-&gt;type == GDK_BUTTON_PRESS) &amp;&amp; (event-&gt;button == 1)  &amp;&amp; (lastclick &lt; event-&gt;time)){
-    lastclick = event-&gt;time + 1000;
-    RunFile(Icon);
- //   static int x;
-    return true;
-    }
-
-  if ((event-&gt;type == GDK_BUTTON_PRESS) &amp;&amp; (event-&gt;button == 3)){
-    //Gtk::Menu::MenuList&amp; menulist = m_Menu_Popup.items();
-
-
-    for( int i=10; i &gt; 0; i--)
-      m_Menu_Popup.items().pop_back();
-//std::cout &lt;&lt; Icon &lt;&lt; &quot;\n&quot;;
-
-        int startAtPos = 0;
-    // following is needed so underscores show correctly
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Open \&quot;&quot; + underscoreSafe(Icon) + &quot;\&quot;&quot;,
-      sigc::bind&lt;Glib::ustring &gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::RunFile),Icon)));
-
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Open as text &quot;,
-      sigc::bind&lt;Glib::ustring &gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::RunFileAsText),Icon)));
-
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::SeparatorElem());
-
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Set Run Action...&quot;,
-      sigc::bind&lt;Glib::ustring&gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::SetRunAction), Icon  )));
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Permissions...&quot;,
-      sigc::bind&lt;Glib::ustring&gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::SetPermissions), Icon  )));
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::SeparatorElem());
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Copy To...&quot;,
-      sigc::bind&lt;Glib::ustring&gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::copy), Icon  )));
-
-
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Move To...&quot;,
-      sigc::bind&lt;Glib::ustring&gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::move), Icon  )));
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Link To...&quot;,
-      sigc::bind&lt;Glib::ustring&gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::link), Icon  )));
-
-    m_Menu_Popup.items().push_back( Gtk::Menu_Helpers::MenuElem(&quot;Delete &quot;,
-      sigc::bind&lt;Glib::ustring&gt;(
-        sigc::mem_fun(*this, &amp;DaIconModes::unlinkify), Icon  )));
-
-
-    m_Menu_Popup.popup(event-&gt;button, event-&gt;time);
-    return true;
-    }
-
-  return false;
-  }
-
 /**********************/
 
-void DaIconModes::on_size_allocate(Gtk::Allocation&amp; allocation){
+DaIconModes::Sidecon::Sidecon(proto_icon &amp; in){
 
+ // image1 = new class Gtk::Image(parent-&gt;getIcon(info-&gt;get_mime_type(), 48));
+Gtk::Image * image = new Gtk::Image(in.icon-&gt;scale_simple(48,48,Gdk::INTERP_TILES));
 
-  if(parent-&gt;get_mode() == 0){
-    int oldie = IconsHigh;
-    IconsHigh = allocation.get_height() / 58;
-  
-    if ( oldie != IconsHigh ){
 
-redraw(); // if resize is needed
-     
-      }
-    }
+  attach(*image, 0, 1, 0, 3, Gtk::FILL, Gtk::FILL, 0, 0);
+  attach(*in.FileName, 1, 2, 0, 1, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
+  attach(*in.FileMime, 1, 2, 1, 2, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
+  attach(*in.FileSize, 1, 2, 2, 3, Gtk::FILL, Gtk::AttachOptions(), 0, 0);
 
-
-  if(parent-&gt;get_mode() == 1 ){
-   
-    Gtk::Widget * tmp = get_child();
-if (!tmp){
-    IconsHigh = 0;
-    if (tmp)
-      delete tmp; // actually DisposableTable, but segfaulted otherwise
-    Gtk::Label * x = new Gtk::Label(&quot;Details go here.&quot;);
-    x-&gt;show();
-    add(*x);
-    }}
-  Gtk::EventBox::on_size_allocate(allocation);
-  }
-
-/**********************/
-
-void DaIconModes::redraw(){
-    Gtk::Widget * tmp = get_child();
-  
-   if (tmp)
-        delete tmp; // actually DisposableTable, but segfaulted otherwise
-      Gtk::Table * DisposableTable = new Gtk::Table((filesAtPath)/IconsHigh+1,IconsHigh);
-      add(*DisposableTable);
-      int y_pos = 0;
-      int x_pos = 0;
-
-      for(int i = 0; i &lt; slotsUsed; i++){
-        if(  !hidden[i] || parent-&gt;optShowHidden-&gt;get_active()){
-          DisposableTable-&gt;attach( *sideconContainer[i],
-              x_pos, x_pos+1, y_pos, y_pos+1,
-              Gtk::FILL, Gtk::FILL, 4, 4);
-          sideconContainer[i]-&gt;show();
-          y_pos++; 
-          if(parent-&gt;get_mode() == 0){
-            if ( y_pos + 1 &gt; IconsHigh){
-              y_pos = 0;
-              x_pos++;
-              }
-            }
-          }
-        }
-      DisposableTable-&gt;show();
-  
-  }
-
-/**********************/
-
-DaIconModes::ChooseActionDialogue::ChooseActionDialogue(Glib::ustring mimeType){
-
-  mime = mimeType;
-  cancelbutton1 = new class Gtk::Button(Gtk::StockID(&quot;gtk-close&quot;));
-  okbutton1 = new class Gtk::Button(Gtk::StockID(&quot;gtk-apply&quot;));
-  label1 = new class Gtk::Label(&quot;Enter a Shell command:&quot;);
-  entry1 = new class Gtk::Entry();
-  vbox1  = new class Gtk::VBox(false, 0);
-
-
-  radiobutton1 = new class Gtk::RadioButton(_RadioBGroup_radiobutton1, 
-    &quot;Set Action For \&quot;&quot; + mimeType.substr(0, mimeType.find(&quot;_&quot;)) + &quot;\&quot;&quot; );
-
-  radiobutton1-&gt;signal_clicked().connect(
-      sigc::bind&lt;Glib::ustring &gt;( sigc::mem_fun(*this,
-      &amp;DaIconModes::ChooseActionDialogue::GetCurrentAction), mimeType.substr(0, mimeType.find(&quot;_&quot;)) ));
-
- radiobutton2 = new class Gtk::RadioButton(_RadioBGroup_radiobutton1,
-      &quot;Set Action For \&quot;&quot; + mimeType + &quot;\&quot;&quot;)  ;
-
-  radiobutton2-&gt;signal_clicked().connect(
-      sigc::bind&lt;Glib::ustring &gt;( sigc::mem_fun(*this,
-      &amp;DaIconModes::ChooseActionDialogue::GetCurrentAction), mimeType ));
-
-  cancelbutton1-&gt;set_flags(Gtk::CAN_FOCUS);
-  cancelbutton1-&gt;set_flags(Gtk::CAN_DEFAULT);
-  cancelbutton1-&gt;signal_clicked().connect(
-      sigc::mem_fun(*this, &amp;DaIconModes::ChooseActionDialogue::cancled) );
-  okbutton1-&gt;set_flags(Gtk::CAN_FOCUS);
-  okbutton1-&gt;set_flags(Gtk::CAN_DEFAULT);
-  okbutton1-&gt;signal_clicked().connect(
-      sigc::mem_fun(*this, &amp;DaIconModes::ChooseActionDialogue::modifyAction) );
-  get_action_area()-&gt;property_layout_style().set_value(Gtk::BUTTONBOX_END);
-  radiobutton1-&gt;set_flags(Gtk::CAN_FOCUS);
-  radiobutton1-&gt;set_mode(true);
-  radiobutton1-&gt;set_active(false);
-  radiobutton2-&gt;set_flags(Gtk::CAN_FOCUS);
-  radiobutton2-&gt;set_mode(true);
-  radiobutton2-&gt;set_active(true);
-  label1-&gt;set_padding(2,4);
-  label1-&gt;set_justify(Gtk::JUSTIFY_LEFT);
-  entry1-&gt;set_flags(Gtk::CAN_FOCUS);
-  entry1-&gt;set_has_frame(true);
-  vbox1-&gt;pack_start(*radiobutton1, Gtk::PACK_SHRINK, 0);
-  vbox1-&gt;pack_start(*radiobutton2, Gtk::PACK_SHRINK, 0);
-  vbox1-&gt;pack_start(*label1, Gtk::PACK_SHRINK, 0);
-  vbox1-&gt;pack_start(*entry1, Gtk::PACK_SHRINK, 0);
-  get_vbox()-&gt;set_homogeneous(false);
-  get_vbox()-&gt;set_spacing(5);
-  get_vbox()-&gt;set_border_width(6);
-  get_vbox()-&gt;pack_start(*vbox1);
-  set_border_width(6);
-  set_title(&quot;Set Run Action&quot;);
-  set_modal(true);
-  property_window_position().set_value(Gtk::WIN_POS_CENTER_ON_PARENT);
-  set_resizable(true);
-  property_destroy_with_parent().set_value(false);
-  set_has_separator(false);
-  add_action_widget(*cancelbutton1, Gtk::RESPONSE_CANCEL);
-  add_action_widget(*okbutton1, Gtk::RESPONSE_OK);
-  set_default_response(Gtk::RESPONSE_OK);
-
   show_all_children();
   }
 
 /**********************/
 
-void DaIconModes::ChooseActionDialogue::GetCurrentAction(Glib::ustring mimeType){
-
-  Glib::ustring contents, exec1 = getenv(&quot;HOME&quot;);
-  exec1 += (Glib::ustring)(&quot;/Choices/MIME-types/&quot;);
-  exec1 += mimeType;
-
-  try {
-    contents = Glib::file_get_contents(exec1);
-    contents = contents.substr(contents.find(&quot;exec &quot;) + 5);
-    contents = contents.substr(0,contents.find(&quot;\n&quot;));
-    }
-  catch(const Glib::Error) {
-    contents = &quot;* \&quot;$@\&quot;&quot; ;
-    }
-  entry1-&gt;set_text(contents);
-}
-
-/**********************/
-
-void DaIconModes::ChooseActionDialogue::cancled(){
-  hide();
-  return;
-  }
-
-/**********************/
-
-void DaIconModes::ChooseActionDialogue::modifyAction(){
-
-  if ( entry1-&gt;get_text() != &quot;* \&quot;$@\&quot;&quot;){ //don't intentionally make a broken script.
-    Glib::ustring command = &quot;#! /bin/sh\nexec &quot;;
-    command += entry1-&gt;get_text();
-    command += &quot;\n&quot;;
-
-    try {
-      Glib::ustring exec1 = getenv(&quot;HOME&quot;);
-      exec1 += (Glib::ustring)(&quot;/Choices/MIME-types/&quot;);
-      if(radiobutton2-&gt;get_active()) exec1 += mime;
-      if(radiobutton1-&gt;get_active())exec1 += mime.substr(0, mime.find(&quot;_&quot;));
-      Gnome::Vfs::Handle write_handle;
-
-      // Now write the data we read out to the output uri
-      write_handle.create(exec1, Gnome::Vfs::OPEN_WRITE, false, 0755);
-      write_handle.seek(Gnome::Vfs::SEEK_POS_START, 0);
-      GnomeVFSFileSize bytes_written = write_handle.write(command.data(), command.size());
-      }
-    catch(const Gnome::Vfs::exception) {
-  //  parent-&gt;set_message(&quot;Couldn't write new definition.&quot;);
-      hide();
-      return;
-      }
-    }
-  hide();
-  return;
-  }
-
-/**********************/
-
-void DaIconModes::SetPermissions(const Glib::ustring file) {
-
-
-  Gnome::Vfs::Handle read_handle;
-  Glib::RefPtr&lt;Gnome::Vfs::FileInfo&gt; info;
-
-  try {
-    read_handle.open( parent-&gt;history[position].top() + file, Gnome::Vfs::OPEN_READ);
-    info = read_handle.get_file_info(Gnome::Vfs::FILE_INFO_GET_ACCESS_RIGHTS);
-
-    SetPermissionsDialogue * setPermissions;
-    setPermissions = new SetPermissionsDialogue(info,parent-&gt;history[position].top());
-    setPermissions-&gt;show();
-    }
-  catch(const Gnome::Vfs::exception&amp; ex) {
-    parent-&gt;set_message(&quot;Err... Setting error?&quot;);
-    }
-  }
-
-/**********************/
-
-void DaIconModes::copy(const Glib::ustring file) {
-  CopyDialogue * cp =  new CopyDialogue( parent-&gt;history[position].top() + file , *parent);
-  cp-&gt;show();
-  }
-
-/**********************/
-
-void DaIconModes::move(const Glib::ustring file) {
-  MoveDialogue * mv =  new MoveDialogue( parent-&gt;history[position].top() + file , *parent);
-  mv-&gt;show();
-  }
-
-/**********************/
-
-void DaIconModes::link(const Glib::ustring file) {
-  LinkDialogue * ln =  new LinkDialogue( parent-&gt;history[position].top() + file , *parent);
-  ln-&gt;show();
-  }
-
-/**********************/
-
-void DaIconModes::unlinkify(const Glib::ustring file) {
-  DeleteDialogue * del =  new DeleteDialogue( parent-&gt;history[position].top() + file , *parent);
-  del-&gt;show();
-  }
-
-/**********************/
-
-DaIconModes::SetPermissionsDialogue::SetPermissionsDialogue(
-    Glib::RefPtr&lt;Gnome::Vfs::FileInfo&gt; info, Glib::ustring path){
-fullPath = path;
-  set_title(&quot;Set file permissions&quot;);
-  set_modal(true);
-
-   read = new class Gtk::Label(&quot;R&quot;);
-   write = new class Gtk::Label(&quot;W&quot;);
-   run = new class Gtk::Label(&quot;X&quot;);
-   user = new class Gtk::Label(&quot;User&quot;);
-   group = new class Gtk::Label(&quot;Group&quot;);
-   others = new class Gtk::Label(&quot;Everybody&quot;);
-
-   explaination = new class Gtk::Label(&quot;for \&quot;&quot;+ info-&gt;get_name() + &quot;\&quot;...&quot;);
-
-   layout = new class Gtk::Table(5, 6, false);
-
-   u_r = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_USER_READ) != 0)  u_r-&gt;set_active(true);
-   u_w = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_USER_WRITE) != 0)  u_w-&gt;set_active(true);
-   u_x = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_USER_EXEC) != 0)  u_x-&gt;set_active(true);
-   g_r = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_GROUP_READ) != 0)  g_r-&gt;set_active(true);
-   g_w = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_GROUP_WRITE) != 0)  g_w-&gt;set_active(true);
-   g_x = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_GROUP_EXEC) != 0)  g_x-&gt;set_active(true);
-   o_r = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_OTHER_READ) != 0)  o_r-&gt;set_active(true);
-   o_w = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_OTHER_WRITE) != 0)  o_w-&gt;set_active(true);
-   o_x = new class Gtk::CheckButton(&quot;&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_OTHER_EXEC) != 0)  o_x-&gt;set_active(true);
-
-   extra = new  Gtk::VSeparator;
-
-   sticky = new class Gtk::CheckButton(&quot;Sticky&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_STICKY) != 0)  sticky-&gt;set_active(true);
-   GID = new class Gtk::CheckButton(&quot;Group ID&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_SGID) != 0)  GID-&gt;set_active(true);
-   UID = new class Gtk::CheckButton(&quot;User ID&quot;);
-   if((info-&gt;get_permissions() &amp; Gnome::Vfs::PERM_SUID) != 0)  UID-&gt;set_active(true);
-
-   layout-&gt;attach(*u_r, 1, 2, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*u_w, 2, 3, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*u_x, 3, 4, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*g_r, 1, 2, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*g_w, 2, 3, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*g_x, 3, 4, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*o_r, 1, 2, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*o_w, 2, 3, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*o_x, 3, 4, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
-
-   layout-&gt;attach(*extra,4,5,1,5, Gtk::FILL | Gtk::EXPAND, Gtk::FILL, 10, 0);
-
-   layout-&gt;attach(*sticky, 5, 6, 2, 3, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*GID, 5, 6, 3, 4, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*UID, 5, 6, 4, 5, Gtk::FILL, Gtk::FILL, 0, 0);
-
-   layout-&gt;attach(*read, 1, 2, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*write, 2, 3, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*run, 3, 4, 1, 2, Gtk::FILL, Gtk::FILL, 0, 0);
-   layout-&gt;attach(*user, 0, 1, 2, 3, Gtk::FILL , Gtk::FILL, 0, 0);
-   layout-&gt;attach(*group, 0, 1, 3, 4, Gtk::FILL , Gtk::FILL, 0, 0);
-   layout-&gt;attach(*others, 0, 1, 4, 5, Gtk::FILL , Gtk::FILL, 0, 0);
-   layout-&gt;attach(*explaination, 0, 6, 0, 1, Gtk::FILL | Gtk::EXPAND, Gtk::FILL, 10, 0);
-
-
-  get_vbox()-&gt;pack_start(*layout);
-  button1 = new class Gtk::Button(Gtk::StockID(&quot;gtk-cancel&quot;));
-  button1-&gt;signal_clicked().connect(
-      sigc::mem_fun(*this, &amp;DaIconModes::SetPermissionsDialogue::cancled) );
-
-
-  button2 = new class Gtk::Button(Gtk::StockID(&quot;gtk-apply&quot;));
-  button2-&gt;signal_clicked().connect(
-    sigc::bind&lt;Glib::RefPtr&lt;Gnome::Vfs::FileInfo&gt; &gt;(
-      sigc::mem_fun(*this, &amp;DaIconModes::SetPermissionsDialogue::apply), info ));
-
-
-  get_action_area()-&gt;property_layout_style().set_value(Gtk::BUTTONBOX_END);
-  add_action_widget(*button1, -6);
-  add_action_widget(*button2, -10);
-
-  set_modal(true);
-  show_all_children();
-  show();
-  }
-
-/**********************/
-
-void DaIconModes::SetPermissionsDialogue::cancled(){
-  hide();
-  }
-
-/**********************/
-
-void DaIconModes::SetPermissionsDialogue::apply(Glib::RefPtr&lt;Gnome::Vfs::FileInfo&gt; info){
-
-  // *nix and *BSD only, blah blah blah.
-  int permissions = 0;
-
-
-
-  if(UID-&gt;get_active()) permissions += 2048;
-  if(GID-&gt;get_active()) permissions += 1024;
-  if(sticky-&gt;get_active()) permissions += 512;
-
-  if(u_r-&gt;get_active()) permissions += 256;
-  if(u_w-&gt;get_active()) permissions += 128;
-  if(u_x-&gt;get_active()) permissions += 64;
-
-  if(g_r-&gt;get_active()) permissions += 32;
-  if(g_w-&gt;get_active()) permissions += 16;
-  if(g_x-&gt;get_active()) permissions += 8;
-
-  if(o_r-&gt;get_active()) permissions += 4;
-  if(o_w-&gt;get_active()) permissions += 2;
-  if(o_x-&gt;get_active()) permissions += 1;
-
-  chmod((fullPath + info-&gt;get_name()).c_str(), permissions);
-
-  hide();
-  }
-
-/**********************/
-
-DaIconModes::SetPermissionsDialogue::~SetPermissionsDialogue(){
-      delete read;
-      delete write;
-      delete run;
-      delete user;
-      delete group;
-      delete others;
-      delete explaination;
-      delete layout;
-      delete u_r;
-      delete u_w;
-      delete u_x;
-      delete g_r;
-      delete g_w;
-      delete g_x;
-      delete o_r;
-      delete o_w;
-      delete o_x;
-      delete extra;
-      delete sticky;
-      delete GID;
-      delete UID;
-      delete button1;
-      delete button2;
-      }
-
-/**********************/
-
-Glib::RefPtr&lt;Gdk::Pixbuf&gt; DaIconModes::getIcon(Glib::ustring mimeGiven, guint size){
+Glib::RefPtr&lt;Gdk::Pixbuf&gt; DaIconModes::getIcon(Glib::ustring mimeGiven){
   int i;
   static std::vector &lt;Glib::ustring&gt; mimeList;
   static std::vector &lt; Glib::RefPtr&lt;Gdk::Pixbuf&gt; &gt; unsizedImg;
@@ -875,8 +90,7 @@
 
   for(i = 0; i&lt; mimeList.size(); i++){
     if( mimeGiven == mimeList[i] ){
-      Glib::RefPtr&lt;Gdk::Pixbuf&gt; scale = unsizedImg[i]-&gt;scale_simple(size,size,Gdk::INTERP_TILES);
-      return scale;
+      return unsizedImg[i];
       }
     }
    // pic doesn't exist.
@@ -907,259 +121,136 @@
 
   unsizedImg.push_back(xe);
 
-  Glib::RefPtr&lt;Gdk::Pixbuf&gt; scale = unsizedImg[i]-&gt;scale_simple(size,size,Gdk::INTERP_TILES);
-  return scale; 
+  return unsizedImg[i]; 
   }
 
 /**********************/
 
- void DaIconModes::SwitchHidden(guint pos){
+bool DaIconModes::addEntry(
+    Glib::ustring rel_path,
+    Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt; info,
+    bool recursing_will_loop,
+    bool recurse) {
 
-position = pos;
-if (parent-&gt;optShowHidden-&gt;get_active())
-    parent-&gt;set_message(&quot;Showing Hidden Files&quot;);
-else
-    parent-&gt;set_message(&quot;Hidden Files are hidden again&quot;);
-
-  redraw();
+  if (info-&gt;get_type() != Gnome::Vfs::FILE_TYPE_DIRECTORY){
+    iconlist[slotsUsed++] = new proto_icon(*this, parent-&gt;history[position].top(), info);
+    }
+  return true;
   }
 
 /**********************/
 
-DaIconModes::CopyDialogue::CopyDialogue(Glib::ustring file, Darimasen&amp; parent){
+void DaIconModes::on_size_allocate(Gtk::Allocation&amp; allocation){
 
-grandparent = &parent;
-   cancelbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-cancel&quot;)));
-   okbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-ok&quot;)));
-   label = Gtk::manage(new class Gtk::Label(file));
-   entry = Gtk::manage(new class Gtk::Entry());
+  int oldie = IconsHigh;
+  IconsHigh = allocation.get_height() / 58;
+  if ( oldie != IconsHigh ){ //if resize is needed
+    Gtk::Widget * tmp = get_child();
 
-   okbutton-&gt;set_flags(Gtk::CAN_FOCUS);
-   okbutton-&gt;set_flags(Gtk::CAN_DEFAULT);
-   cancelbutton-&gt;set_flags(Gtk::CAN_FOCUS);
+  redraw();
+    }
 
-   set_title(&quot;Copy File to&quot;);
-   set_modal(true);
-
-   get_vbox()-&gt;pack_start(*label, Gtk::PACK_SHRINK, 0);
-   get_vbox()-&gt;pack_start(*entry, Gtk::PACK_SHRINK, 0);
-
-
-   entry-&gt;set_text(file);
-
-   add_action_widget(*cancelbutton, -6);
-   add_action_widget(*okbutton, -5);
-
-
-   okbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::CopyDialogue::onOk));
-   cancelbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::CopyDialogue::onCancel));
-
-
-   show_all_children();
+  Gtk::EventBox::on_size_allocate(allocation);
   }
 
 /**********************/
 
-void DaIconModes::CopyDialogue::onOk(){
-//  std::cout &lt;&lt; &quot;copying &quot; &lt;&lt; label-&gt;get_text()
-//    &lt;&lt; &quot;\nto &quot; &lt;&lt; entry-&gt;get_text() &lt;&lt; &quot;\n\n&quot;;
+void DaIconModes::redraw(){
+    Gtk::Widget * tmp = get_child();
+  
+   if (tmp)
+        delete tmp; // actually DisposableTable, but segfaulted otherwise
 
-//rename(label-&gt;get_text().c_str(), entry-&gt;get_text().c_str());
-    Glib::spawn_command_line_async((Glib::ustring)&quot;cp \&quot;&quot;  + label-&gt;get_text().c_str() + (Glib::ustring)&quot;\&quot; \&quot;&quot; + entry-&gt;get_text().c_str()+ &quot;\&quot;&quot;);
+      Gtk::Table * DisposableTable = new Gtk::Table((filesAtPath)/IconsHigh+1,IconsHigh);
 
-  grandparent-&gt;updateView(
-    label-&gt;get_text().substr(0, label-&gt;get_text().rfind(slash,label-&gt;get_text().length())+1),
-    entry-&gt;get_text().substr(0, entry-&gt;get_text().rfind(slash,entry-&gt;get_text().length())+1));
+      add(*DisposableTable);
 
-  hide();
-  }
 
-/**********************/
+      int y_pos = 0;
+      int x_pos = 0;
 
-void DaIconModes::CopyDialogue::onCancel(){
-  hide();
-  }
+      for(int i = 0; i &lt; slotsUsed; i++){
+        if(  !iconlist[i]-&gt;hidden || parent-&gt;optShowHidden-&gt;get_active()){
 
-/**********************/
+          Sidecon * tmpSidecon = new Sidecon(*iconlist[i]);
 
-DaIconModes::CopyDialogue::~CopyDialogue(){}
 
-/**********************/
-/**********************/
 
-DaIconModes::MoveDialogue::MoveDialogue(Glib::ustring file, Darimasen&amp; parent){
+          DisposableTable-&gt;attach( *tmpSidecon, x_pos, x_pos+1, y_pos, y_pos+1,Gtk::FILL, Gtk::FILL, 4, 4);
+          y_pos++; 
+          if(parent-&gt;get_mode() == 0){
+            if ( y_pos + 1 &gt; IconsHigh){
+              y_pos = 0;
+              x_pos++;
+              }
+            }
+          }
+        }
 
-grandparent = &parent;
-   cancelbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-cancel&quot;)));
-   okbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-ok&quot;)));
-   label = Gtk::manage(new class Gtk::Label(file));
-   entry = Gtk::manage(new class Gtk::Entry());
-
-   okbutton-&gt;set_flags(Gtk::CAN_FOCUS);
-   okbutton-&gt;set_flags(Gtk::CAN_DEFAULT);
-   cancelbutton-&gt;set_flags(Gtk::CAN_FOCUS);
-
-   set_title(&quot;Move File to&quot;);
-   set_modal(true);
-
-   get_vbox()-&gt;pack_start(*label, Gtk::PACK_SHRINK, 0);
-   get_vbox()-&gt;pack_start(*entry, Gtk::PACK_SHRINK, 0);
-
-
-   entry-&gt;set_text(file);
-
-   add_action_widget(*cancelbutton, -6);
-   add_action_widget(*okbutton, -5);
-
-
-   okbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::MoveDialogue::onOk));
-   cancelbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::MoveDialogue::onCancel));
-
-
-   show_all_children();
+      DisposableTable-&gt;show();
+        DisposableTable-&gt;show_all_children();
   }
-
+
 /**********************/
 
-void DaIconModes::MoveDialogue::onOk(){
-//  std::cout &lt;&lt; &quot;moveing &quot; &lt;&lt; label-&gt;get_text()
-//    &lt;&lt; &quot;\nto &quot; &lt;&lt; entry-&gt;get_text() &lt;&lt; &quot;\n\n&quot;;
+DaIconModes::DaIconModes(
+      guint pos,
+      Darimasen&amp; myParent) {
 
- // rename(label-&gt;get_text().c_str(), entry-&gt;get_text().c_str());
+  parent = &myParent;
+  position = pos; //where we are in the world
+  mode = parent-&gt;get_mode();
 
-    Glib::spawn_command_line_async((Glib::ustring)&quot;mv \&quot;&quot;  + label-&gt;get_text().c_str() + (Glib::ustring)&quot;\&quot; \&quot;&quot; + entry-&gt;get_text().c_str()+ &quot;\&quot;&quot;);
+  lastclick = 0;  // a double-click detector. 
+  filesAtPath = 0; // count files in directory
 
-  grandparent-&gt;updateView(
-    label-&gt;get_text().substr(0, label-&gt;get_text().rfind(slash,label-&gt;get_text().length())+1),
-    entry-&gt;get_text().substr(0, entry-&gt;get_text().rfind(slash,entry-&gt;get_text().length())+1));
+  try{  //count up the files in the directory. 
+    Gnome::Vfs::DirectoryHandle handle;
+    handle.open((parent-&gt;history[position].top()), Gnome::Vfs::FILE_INFO_DEFAULT);
+    bool file_exists = true;
+    while(file_exists){
+      //if(  handle.read_next(file_exists)-&gt;get_type() != Gnome::Vfs::FILE_TYPE_DIRECTORY )
+      handle.read_next(file_exists);
+      filesAtPath++;
+      }
+    }
+  catch(const Gnome::Vfs::exception&amp;){}
 
-  hide();
-  }
+  set_visible_window(false);
 
-/**********************/
+  iconlist = new proto_icon*[filesAtPath];
+  slotsUsed = 0;
+  IconsHigh = 0;
+  try { // make all those files into proto_icons
+    Gnome::Vfs::DirectoryHandle::visit(
+      parent-&gt;history[position].top(),
+      Gnome::Vfs::FILE_INFO_GET_MIME_TYPE |
+      Gnome::Vfs::FILE_INFO_FORCE_FAST_MIME_TYPE |
+      Gnome::Vfs::FILE_INFO_FOLLOW_LINKS ,
+      Gnome::Vfs::DIRECTORY_VISIT_LOOPCHECK,
+      sigc::mem_fun(*this,&amp;DaIconModes::addEntry));
+    }
+  catch(const Gnome::Vfs::exception&amp; ex){}
 
-void DaIconModes::MoveDialogue::onCancel(){
-  hide();
   }
 
 /**********************/
 
-DaIconModes::MoveDialogue::~MoveDialogue(){}
+DaIconModes::~DaIconModes(){
 
-/**********************/
-/**********************/
-
-DaIconModes::LinkDialogue::LinkDialogue(Glib::ustring file, Darimasen&amp; parent){
-
-grandparent = &parent;
-   cancelbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-cancel&quot;)));
-   okbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-ok&quot;)));
-   label = Gtk::manage(new class Gtk::Label(file));
-   entry = Gtk::manage(new class Gtk::Entry());
-
-   okbutton-&gt;set_flags(Gtk::CAN_FOCUS);
-   okbutton-&gt;set_flags(Gtk::CAN_DEFAULT);
-   cancelbutton-&gt;set_flags(Gtk::CAN_FOCUS);
-
-   set_title(&quot;Link File to&quot;);
-   set_modal(true);
-
-   get_vbox()-&gt;pack_start(*label, Gtk::PACK_SHRINK, 0);
-   get_vbox()-&gt;pack_start(*entry, Gtk::PACK_SHRINK, 0);
-
-
-   entry-&gt;set_text(file);
-
-   add_action_widget(*cancelbutton, -6);
-   add_action_widget(*okbutton, -5);
-
-
-   okbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::LinkDialogue::onOk));
-   cancelbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::LinkDialogue::onCancel));
-
-
-   show_all_children();
   }
 
 /**********************/
 
-void DaIconModes::LinkDialogue::onOk(){
-//  std::cout &lt;&lt; &quot;linking &quot; &lt;&lt; label-&gt;get_text()
- //   &lt;&lt; &quot;\nto &quot; &lt;&lt; entry-&gt;get_text() &lt;&lt; &quot;\n\n&quot;;
+ void DaIconModes::SwitchHidden(guint pos){
 
-  //symlink(label-&gt;get_text().c_str(), entry-&gt;get_text().c_str());
-    Glib::spawn_command_line_async((Glib::ustring)&quot;ln -s \&quot;&quot;  + label-&gt;get_text().c_str() + (Glib::ustring)&quot;\&quot; \&quot;&quot; + entry-&gt;get_text().c_str() + &quot;\&quot;&quot;);
+position = pos;
+if (parent-&gt;optShowHidden-&gt;get_active())
+    parent-&gt;set_message(&quot;Showing Hidden Files&quot;);
+else
+    parent-&gt;set_message(&quot;Hidden Files are hidden again&quot;);
 
-  grandparent-&gt;updateView(
-    label-&gt;get_text().substr(0, label-&gt;get_text().rfind(slash,label-&gt;get_text().length())+1),
-    entry-&gt;get_text().substr(0, entry-&gt;get_text().rfind(slash,entry-&gt;get_text().length())+1));
-
-  hide();
+  redraw();
   }
 
 /**********************/
-
-void DaIconModes::LinkDialogue::onCancel(){
-  hide();
-  }
-
-/**********************/
-
-DaIconModes::LinkDialogue::~LinkDialogue(){}
-
-/**********************/
-/**********************/
-
-DaIconModes::DeleteDialogue::DeleteDialogue(Glib::ustring file, Darimasen&amp; parent){
-
-grandparent = &parent;
-   cancelbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-cancel&quot;)));
-   okbutton = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-ok&quot;)));
-   label = Gtk::manage(new class Gtk::Label(file));
-
-   okbutton-&gt;set_flags(Gtk::CAN_FOCUS);
-   okbutton-&gt;set_flags(Gtk::CAN_DEFAULT);
-   cancelbutton-&gt;set_flags(Gtk::CAN_FOCUS);
-
-   set_title(&quot;Delete File&quot;);
-   set_modal(true);
-
-   get_vbox()-&gt;pack_start(*label, Gtk::PACK_SHRINK, 0);
-
-   add_action_widget(*cancelbutton, -6);
-   add_action_widget(*okbutton, -5);
-
-
-   okbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::DeleteDialogue::onOk));
-   cancelbutton-&gt;signal_clicked().connect_notify(sigc::mem_fun(*this, &amp;DaIconModes::DeleteDialogue::onCancel));
-
-
-   show_all_children();
-  }
-
-/**********************/
-
-void DaIconModes::DeleteDialogue::onOk(){
-//  std::cout &lt;&lt; &quot;delete &quot; &lt;&lt; label-&gt;get_text() &lt;&lt; &quot;\n\n&quot;;
-
- // unlink( label-&gt;get_text().c_str() );
-  Glib::spawn_command_line_async((Glib::ustring)&quot;rm \&quot;&quot;  + label-&gt;get_text().c_str() + &quot;\&quot;&quot;);
-
-  grandparent-&gt;updateView(
-    label-&gt;get_text().substr(0, label-&gt;get_text().rfind(slash,label-&gt;get_text().length())+1),
-    label-&gt;get_text().substr(0, label-&gt;get_text().rfind(slash,label-&gt;get_text().length())+1));
-   //std::cout &lt;&lt; label-&gt;get_text().substr(0, label-&gt;get_text().rfind(slash,label-&gt;get_text().length())+1) ;
-  hide();
-  }
-
-/**********************/
-
-void DaIconModes::DeleteDialogue::onCancel(){
-  hide();
-  }
-
-/**********************/
-
-DaIconModes::DeleteDialogue::~DeleteDialogue(){}
-
-/**********************/

Modified: trunk/src/iconmodes.h
===================================================================
--- trunk/src/iconmodes.h	2005-04-19 18:26:51 UTC (rev 56)
+++ trunk/src/iconmodes.h	2005-04-20 15:32:37 UTC (rev 57)
@@ -1,212 +1,63 @@
 /* Darimasen - iconmodes.h - Copyright (C) 2004 - 2005 Sudrien, GPL */
 
 #ifndef ICONMODES_H
-#define ICONMODES_H
-
-/**********************/
-
-#include &lt;gtkmm/table.h&gt;
-#include &lt;gtkmm/messagedialog.h&gt;
-#include &quot;main.h&quot;
-#include &lt;libgnomevfsmm.h&gt;
-#include &lt;gtkmm/entry.h&gt;
-#include &lt;gdkmm/pixbuf.h&gt;
-#include &quot;iconmodes.h&quot;
-#include &quot;darimasen.h&quot;
-#include &lt;gtkmm/separator.h&gt;
-#include &lt;unistd.h&gt;
-
-/**********************/
-
-class DaIconModes : public Gtk::EventBox {
+#define ICONMODES_H
 
 
-  class Sidecon : public Gtk::Table {
-    Glib::ustring filePath, mimeInfo;
-    DaIconModes * parent;
-    Gtk::Image * image1;
-    Gtk::Label * FileName;
-    Gtk::Label * FilePermissions ;
-    Gtk::Label * FileSizeInfo;
-  public:
-    Sidecon(Glib::ustring, const Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt;&amp;, DaIconModes&amp;);
-    ~Sidecon(){
-      delete image1;
-      delete FileName;
-      delete FilePermissions;
-      delete FileSizeInfo;
-      }
+#include &quot;darimasen.h&quot;
+#include &lt;libgnomevfsmm.h&gt;
+#include &lt;gtkmm/table.h&gt;
+#include &lt;gdkmm/pixbuf.h&gt;
 
-    };
+/**********************/
 
-/*
-  class Detail : public Gtk::Table {
-    public:
-    Glib::ustring filePath, mimeInfo;
-    Detail(Glib::ustring, const Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt;&amp; );
-    };
-*/
+class DaIconModes : public Gtk::EventBox {
 
-  class ChooseActionDialogue : public Gtk::Dialog {
-    Gtk::RadioButton::Group _RadioBGroup_radiobutton1;
-    Gtk::Button *cancelbutton1, *okbutton1;
-    Gtk::RadioButton *radiobutton1, *radiobutton2;
-    Gtk::Label       * label1;
-    Gtk::Entry       * entry1;
-    Gtk::VBox        * vbox1;
-    Glib::ustring mime;
-    void cancled();
-    void modifyAction();
-    void GetCurrentAction(Glib::ustring);
+  class proto_icon {
+    Glib::ustring path;
    DaIconModes * parent;
 
-    public:
-
-    ChooseActionDialogue(Glib::ustring);
-    ~ChooseActionDialogue(){
-
-      delete cancelbutton1;
-      delete okbutton1;
-      delete label1;
-      delete entry1;
-      delete vbox1;
-      delete radiobutton1;
-      delete radiobutton2;
-      }
-    };
-
-
-  class SetPermissionsDialogue : public Gtk::Dialog {
-    Glib::ustring fullPath;
-    Gtk::Button * button1;
-    Gtk::Button * button2;
-
-    Gtk::CheckButton * u_r, * u_w, * u_x;
-    Gtk::CheckButton * g_r, * g_w, * g_x;
-    Gtk::CheckButton * o_r, * o_w, * o_x;
-    
-    Gnome::Vfs::Handle info;
-
-    Gtk::VSeparator * extra;
-    Gtk::CheckButton * sticky, * GID, * UID;
-
-    Gtk::Label * user, * group, * others;
-    Gtk::Label * read, * write, * run;
-    Gtk::Label * explaination;
-
-    Gtk::Table * layout;
-    void cancled();
-    void apply(Glib::RefPtr&lt;Gnome::Vfs::FileInfo&gt;);
-
-    public:
-
-    SetPermissionsDialogue(Glib::RefPtr&lt;Gnome::Vfs::FileInfo&gt; , Glib::ustring);
-    ~SetPermissionsDialogue();
-    };
-
-  class CopyDialogue : public Gtk::Dialog {
-    class Gtk::Button * cancelbutton;
-    class Gtk::Button * okbutton;
-    class Gtk::Label * label;
-    class Gtk::Entry * entry;
-    void onOk();
-    void onCancel();
-
-    class Darimasen * grandparent;
-
   public:
-    CopyDialogue(Glib::ustring, Darimasen&amp;);
-    ~CopyDialogue();
-    };
-//
-  class LinkDialogue : public Gtk::Dialog {
-    class Gtk::Button * cancelbutton;
-    class Gtk::Button * okbutton;
-    class Gtk::Label * label;
-    class Gtk::Entry * entry;
-    void onOk();
-    void onCancel();
 
-    class Darimasen * grandparent;
+    Glib::RefPtr&lt;Gdk::Pixbuf&gt; icon;
+    Gtk::Label * FileName;
+    Gtk::Label * ShortFileName;
+    Gtk::Label * FileMime;
+    Gtk::Label * FileSize;
+    bool hidden;
 
-  public:
-    LinkDialogue(Glib::ustring, Darimasen&amp;);
-    ~LinkDialogue();
+    proto_icon(DaIconModes&amp;, Glib::ustring, const Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt;);
+    ~proto_icon();
     };
-//
-  class MoveDialogue : public Gtk::Dialog {
-    class Gtk::Button * cancelbutton;
-    class Gtk::Button * okbutton;
-    class Gtk::Label * label;
-    class Gtk::Entry * entry;
-    void onOk();
-    void onCancel();
 
-    class Darimasen * grandparent;
-
+  class Sidecon : public Gtk::Table {
   public:
-    MoveDialogue(Glib::ustring, Darimasen&amp;);
-    ~MoveDialogue();
-    };
-//
-  class DeleteDialogue : public Gtk::Dialog {
-    class Gtk::Button * cancelbutton;
-    class Gtk::Button * okbutton;
-    class Gtk::Label * label;
-    void onOk();
-    void onCancel();
+    Sidecon(proto_icon&amp;);
+  };
 
-    class Darimasen * grandparent;
 
-  public:
-    DeleteDialogue(Glib::ustring, Darimasen&amp;);
-    ~DeleteDialogue();
-    };
-//
 
-  class Darimasen * parent;
-
-
-
-  void RunFile(const Glib::ustring);
-  void RunFileAsText(const Glib::ustring);
-
-  void SetRunAction(const Glib::ustring);
-  void SetPermissions(const Glib::ustring);
-
-  void copy(const Glib::ustring);
-  void move(const Glib::ustring);
-  void link(const Glib::ustring);
-  void unlinkify(const Glib::ustring);
-
-  bool on_eventbox_button_press(GdkEventButton*, const Glib::ustring);
+  Glib::RefPtr&lt;Gdk::Pixbuf&gt; getIcon(Glib::ustring);
+  bool addEntry(Glib::ustring, Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt;, bool, bool);
   void on_size_allocate(Gtk::Allocation&amp;);
   void redraw();
-  bool addEntry(Glib::ustring, Glib::RefPtr&lt;const Gnome::Vfs::FileInfo&gt;, bool, bool);
-  Glib::RefPtr&lt;Gdk::Pixbuf&gt; getIcon(Glib::ustring, guint);
 
-
-
-  Gtk::EventBox ** sideconContainer;
-
-  Gtk::Menu m_Menu_Popup;
-
-
-//  unsigned short iconmode;
+  class Darimasen * parent;
+  guint position;
   guint32 lastclick;
+  guint filesAtPath;
+  gshort mode;
+  proto_icon ** iconlist;
   guint slotsUsed;
   guint IconsHigh;
-  guint position;
-  guint filesAtPath;
-  int * hidden;
 
-
+
 public:
   ~DaIconModes();
-  DaIconModes(guint, Darimasen&amp;);
+  DaIconModes(guint, class Darimasen&amp;);
 
-  void SwitchHidden(guint);
-  };
-
+  void SwitchHidden(guint);
+};
+
 /**********************/
 
 #endif //ICONMODES_H


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000009.html">[Darimasen-svn] r56 - trunk/src
</A></li>
	<LI>Next message: <A HREF="000011.html">[Darimasen-svn] r58 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#10">[ date ]</a>
              <a href="thread.html#10">[ thread ]</a>
              <a href="subject.html#10">[ subject ]</a>
              <a href="author.html#10">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/darimasen-svn">More information about the Darimasen-svn
mailing list</a><br>
</body></html>
