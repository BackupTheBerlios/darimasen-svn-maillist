<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Darimasen-svn] r72 - in trunk: . pixmaps pixmaps/16x16 src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/darimasen-svn/2005-May/index.html" >
   <LINK REL="made" HREF="mailto:darimasen-svn%40lists.berlios.de?Subject=Re%3A%20%5BDarimasen-svn%5D%20r72%20-%20in%20trunk%3A%20.%20pixmaps%20pixmaps/16x16%20src&In-Reply-To=%3C200505141718.j4EHIh9f003286%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000021.html">
   <LINK REL="Next"  HREF="000023.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Darimasen-svn] r72 - in trunk: . pixmaps pixmaps/16x16 src</H1>
    <B>darimasen-svn-admin at lists.berlios.de</B> 
    <A HREF="mailto:darimasen-svn%40lists.berlios.de?Subject=Re%3A%20%5BDarimasen-svn%5D%20r72%20-%20in%20trunk%3A%20.%20pixmaps%20pixmaps/16x16%20src&In-Reply-To=%3C200505141718.j4EHIh9f003286%40sheep.berlios.de%3E"
       TITLE="[Darimasen-svn] r72 - in trunk: . pixmaps pixmaps/16x16 src">darimasen-svn-admin at lists.berlios.de
       </A><BR>
    <I>Sat May 14 19:18:43 CEST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="000021.html">[Darimasen-svn] r71 - trunk/src
</A></li>
        <LI>Next message: <A HREF="000023.html">[Darimasen-svn] r74 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22">[ date ]</a>
              <a href="thread.html#22">[ thread ]</a>
              <a href="subject.html#22">[ subject ]</a>
              <a href="author.html#22">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: metwo
Date: 2005-05-14 19:18:39 +0200 (Sat, 14 May 2005)
New Revision: 72

Added:
   trunk/pixmaps/16x16/
   trunk/pixmaps/16x16/Makefile.am
   trunk/pixmaps/16x16/darimasen.png
   trunk/src/optionsManager.cpp
   trunk/src/optionsManager.h
Modified:
   trunk/AUTHORS
   trunk/Makefile.am
   trunk/autogen.sh
   trunk/configure.in
   trunk/pixmaps/Makefile.am
   trunk/src/Makefile.am
   trunk/src/damenu.cpp
   trunk/src/damenu.h
   trunk/src/darimasen.cpp
   trunk/src/darimasen.h
   trunk/src/firsttime.cpp
   trunk/src/firsttime.h
   trunk/src/iconmodes.cpp
   trunk/src/iconmodes.h
   trunk/src/main.cpp
   trunk/src/main.h
   trunk/src/supplimental.cpp
   trunk/src/supplimental.h
Log:
Added the beginnings of session management, safer selecting as proposed 
by neuron on the forums, optimizations all over.


Modified: trunk/AUTHORS
===================================================================
--- trunk/AUTHORS	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/AUTHORS	2005-05-14 17:18:39 UTC (rev 72)
@@ -17,8 +17,9 @@
 (<A HREF="http://regexxer.sourceforge.net/">http://regexxer.sourceforge.net/</A>) - their autogen.sh was consuted,
 at least. ^_^
 
-Some code was generated by glademm.
+Portions of the code were generated by glademm.
 
-Includes files from BinReloc-1.5:  
-(<A HREF="http://autopackage.org/docs/binreloc/">http://autopackage.org/docs/binreloc/</A>)
+Portions of the code were stolen directly from the glibmm examples,
+ and brutalized until they did our bidding.
 
+

Modified: trunk/Makefile.am
===================================================================
--- trunk/Makefile.am	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/Makefile.am	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,15 +1,9 @@
 SUBDIRS = pixmaps src
 
-
-
-#/usr/share/applications/darimasen.desktop
-
-
 appdir = \
         $(datadir)/applications
 
 app_DATA = \
         darimasen.desktop
 
-
 EXTRA_DIST = AUTHORS TODO README configure $(app_DATA)

Modified: trunk/autogen.sh
===================================================================
--- trunk/autogen.sh	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/autogen.sh	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,6 +1,4 @@
 #!/bin/sh
-# generated 2004/9/10 11:30:35 CEST by <A HREF="https://lists.berlios.de/mailman/listinfo/darimasen-svn">nick at frisbee.mnc.ch.</A>(none)
-# using glademm V2.6.0_cvs
 
 export WANT_AUTOMAKE=&quot;1.7&quot;
 

Modified: trunk/configure.in
===================================================================
--- trunk/configure.in	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/configure.in	2005-05-14 17:18:39 UTC (rev 72)
@@ -22,4 +22,9 @@
 
 
 
-AC_OUTPUT([Makefile src/Makefile pixmaps/Makefile pixmaps/48x48/Makefile pixmaps/scalable/Makefile])
+AC_OUTPUT([Makefile \
+        src/Makefile \
+        pixmaps/Makefile \
+        pixmaps/16x16/Makefile \
+        pixmaps/48x48/Makefile \
+        pixmaps/scalable/Makefile])

Added: trunk/pixmaps/16x16/Makefile.am
===================================================================
--- trunk/pixmaps/16x16/Makefile.am	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/pixmaps/16x16/Makefile.am	2005-05-14 17:18:39 UTC (rev 72)
@@ -0,0 +1,12 @@
+appsicondir = \
+	$(datadir)/icons/hicolor/16x16/apps
+
+appsicon_DATA = \
+        darimasen.png
+
+EXTRA_DIST = \
+        $(appsicon_DATA)
+
+MAINTAINERCLEANFILES = \
+        Makefile.in
+

Added: trunk/pixmaps/16x16/darimasen.png
===================================================================
(Binary files differ)


Property changes on: trunk/pixmaps/16x16/darimasen.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: trunk/pixmaps/Makefile.am
===================================================================
--- trunk/pixmaps/Makefile.am	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/pixmaps/Makefile.am	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,5 +1,5 @@
 SUBDIRS = \
-	scalable 48x48
+	scalable 16x16 48x48
 
 appsicondir = \
         $(datadir)/pixmaps

Modified: trunk/src/Makefile.am
===================================================================
--- trunk/src/Makefile.am	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/Makefile.am	2005-05-14 17:18:39 UTC (rev 72)
@@ -7,16 +7,16 @@
 	supplimental.cpp \
         firsttime.cpp \
 	main.cpp \
-	damenu.cpp 
-
+	damenu.cpp \
+        optionsManager.cpp
 noinst_HEADERS = \
 	darimasen.h \
 	iconmodes.h \
 	supplimental.h \
         firsttime.h \
 	main.h \
-	damenu.h 
-
+	damenu.h \
+        optionsManager.h
 AM_CXXFLAGS = -I../.. @PKG_CFLAGS@
 
 darimasen_LDADD = -lpthread @LIBS@ @PKG_LIBS@ 

Modified: trunk/src/damenu.cpp
===================================================================
--- trunk/src/damenu.cpp	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/damenu.cpp	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,11 +1,9 @@
-
 /* Darimasen - damenu.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
 
 /**********************/
 
 #include &quot;damenu.h&quot;
 
-
 /**********************/
 
 
@@ -457,15 +455,15 @@
 
   depth = 0;
 
-  Glib::ustring shortpath = path; //home = getenv(&quot;HOME&quot;);
+  Glib::ustring shortpath = path; //home = Glib::get_home_dir();
 
   parent = &Myparent;
   
   int startPos = 0 , i = 0;
 
 
-  if ( path.find(getenv(&quot;HOME&quot;)) != Glib::ustring::npos ){
-    shortpath.replace(0,((Glib::ustring)getenv(&quot;HOME&quot;)).length(),&quot;~&quot;);
+  if ( path.find(Glib::get_home_dir()) != Glib::ustring::npos ){
+    shortpath.replace(0,((Glib::ustring)Glib::get_home_dir()).length(),&quot;~&quot;);
     }
 
   while ( (shortpath.find(slash,startPos) != Glib::ustring::npos) ) {
@@ -547,7 +545,7 @@
           subdir2-&gt;signal_button_press_event().connect(
             sigc::bind&lt;Glib::ustring,guint,bool&gt;(
               sigc::mem_fun(*this, &amp;DarimasenMenu::DaMenuSelect),
-                getenv(&quot;HOME&quot;),pos,false));
+                Glib::get_home_dir(),pos,false));
 
     Gtk::SeparatorMenuItem * sep = Gtk::manage( new Gtk::SeparatorMenuItem());
     MenuArray[0]-&gt;attach(*sep, 0 ,1, 2, 3);

Modified: trunk/src/damenu.h
===================================================================
--- trunk/src/damenu.h	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/damenu.h	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,28 +1,15 @@
-/* Darimasen - darimasen.h - Copyright (C) 2004 - 2005 Sudrien, GPL
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License version 2
- * as published by the Free Software Foundation.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
- */
+/* Darimasen - damenu.h - Copyright (C) 2004 - 2005 Sudrien, GPL */
 
-
 #ifndef DAMENU_H
 #define DAMENU_H
 
+/**********************/
 
-#include &lt;gtkmm.h&gt;
+#include &quot;main.h&quot;
 #include &quot;darimasen.h&quot;
-#include &lt;iostream&gt;
 
+/**********************/
+
   class DarimasenMenu : public Gtk::MenuBar {
 
     class Darimasen * parent;

Modified: trunk/src/darimasen.cpp
===================================================================
--- trunk/src/darimasen.cpp	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/darimasen.cpp	2005-05-14 17:18:39 UTC (rev 72)
@@ -3,14 +3,12 @@
 /**********************/
 
 #include &quot;darimasen.h&quot;
-#include &lt;iostream&gt;
 
-
 /**********************/
 
 // anything prefixed with 'f' corresponds with a button. 'nuff said.
 void Darimasen::fNewTab(){
-  set_history(Tabber-&gt;get_n_pages(), getenv(&quot;HOME&quot;) + slash);
+  set_history(Tabber-&gt;get_n_pages(), Glib::get_home_dir() + slash);
   addTab(Tabber-&gt;get_n_pages());
 
   }
@@ -65,7 +63,7 @@
 
   if ( get_history(pos) == slash)
     tabNum = new Gtk::Label(slash + &quot; &quot;);
-  else if ( get_history(pos) == (getenv(&quot;HOME&quot;) + slash))
+  else if ( get_history(pos) == (Glib::get_home_dir() + slash))
     tabNum = new Gtk::Label(&quot;~ &quot;);
   else
     tabNum = new Gtk::Label(
@@ -292,6 +290,9 @@
     set_history(i,paths[i]);
     addTab(Tabber-&gt;get_n_pages());
     }
+
+
+myOptions = new optionsQuery(Glib::get_home_dir() + getchoicesdir() + &quot;/Darimasen/Options&quot;);
  }
 
 /**********************/
@@ -328,8 +329,8 @@
     //mimeList[i].clear();
  //   unsizedImg[i].clear();
   //  }
+  delete myOptions;
 
-
   hide();
   }
 

Modified: trunk/src/darimasen.h
===================================================================
--- trunk/src/darimasen.h	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/darimasen.h	2005-05-14 17:18:39 UTC (rev 72)
@@ -20,46 +20,14 @@
 
 /**********************/
 
-#include &lt;gtkmm/window.h&gt;
-#include &lt;stack&gt;
-#include &lt;gtkmm/box.h&gt;
-#include &lt;gtkmm/toolbar.h&gt;
-#include &lt;gtkmm/separatortoolitem.h&gt;
-#include &lt;gtkmm/toggletoolbutton.h&gt;
-#include &lt;gtkmm/toolbutton.h&gt;
-#include &lt;gtkmm/menubar.h&gt;
-#include &lt;gtkmm/paned.h&gt;
-#include &lt;gtkmm/scrolledwindow.h&gt;
-#include &lt;gtkmm/eventbox.h&gt;
-#include &lt;gtkmm/statusbar.h&gt;
-#include &lt;gtkmm/menu.h&gt;
-#include &lt;gtkmm/stock.h&gt;
-
-
 #include &quot;main.h&quot;
-#include &lt;sys/types.h&gt;
-#include &lt;gtkmm/eventbox.h&gt;
-
-#include &lt;gtkmm/menuitem.h&gt;
+#include &lt;sys/types.h&gt;
+#include &lt;gtkmm/menutoolbutton.h&gt;
 
-
-#include &quot;supplimental.h&quot;
-#include &lt;iostream&gt;
-#include &lt;gtkmm/scrollbar.h&gt;
-#include &lt;gtkmm/treemodel.h&gt;
-#include &lt;gtkmm/treestore.h&gt;
-#include &lt;gtkmm/treeview.h&gt;
-#include &lt;gtkmm/notebook.h&gt;
-
-#include &lt;gdkmm/pixbufloader.h&gt;
-
-#include &lt;gtkmm/layout.h&gt;
-
-#include &quot;iconmodes.h&quot;
+#include &quot;optionsManager.h&quot;
 #include &quot;damenu.h&quot;
-#include &lt;gtkmm/menutoolbutton.h&gt;
+#include &quot;iconmodes.h&quot;
 
-
 /**********************/
 
 class Darimasen : public Gtk::Window {
@@ -121,9 +89,9 @@
 
   std::vector&lt; std::vector&lt;Glib::ustring&gt; &gt; history;
 
+class optionsQuery * myOptions;
 
 
-
 public:
 
   std::vector &lt;Glib::ustring&gt; mimeList;

Modified: trunk/src/firsttime.cpp
===================================================================
--- trunk/src/firsttime.cpp	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/firsttime.cpp	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,5 +1,7 @@
 /* Darimasen - firsttime.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
 
+/**********************/
+
 #include &quot;firsttime.h&quot;
 
 /**********************/
@@ -10,7 +12,7 @@
    okbutton1 = Gtk::manage(new class Gtk::Button(Gtk::StockID(&quot;gtk-ok&quot;)));
    image1 = Gtk::manage(new class Gtk::Image(Gtk::StockID(&quot;gtk-dialog-question&quot;), Gtk::IconSize(6)));
    label1 = Gtk::manage(new class Gtk::Label(&quot;It looks like this is your first time\n&quot;
-		&quot;running Darimasen.\n\n&quot;
+		&quot;running Darimasen (and have not used ROX).\n\n&quot;
 		&quot;This is a good time to set up\n&quot;
 		&quot;some default \&quot;Run Actions\&quot;\n\n&quot;
 		&quot;Simply replace the wildcard (*)\n&quot;
@@ -95,7 +97,7 @@
   if ( textentry-&gt;get_text() != &quot;* \&quot;$@\&quot;&quot;){ //don't intentionally make a broken script.
     Glib::ustring command = &quot;#! /bin/sh\nexec &quot; + textentry-&gt;get_text() + &quot;\n&quot;;
     try {
-      Glib::ustring exec1 = (getenv(&quot;HOME&quot;) +  (Glib::ustring)(choicesdir + &quot;/MIME-types/text&quot;));
+      Glib::ustring exec1 = (Glib::get_home_dir() +  (Glib::ustring)(choicesdir + &quot;/MIME-types/text&quot;));
       Gnome::Vfs::Handle write_handle;
       write_handle.create(exec1, Gnome::Vfs::OPEN_WRITE, false, 0755);
       write_handle.seek(Gnome::Vfs::SEEK_POS_START, 0);
@@ -107,7 +109,7 @@
   if ( musicentry-&gt;get_text() != &quot;* \&quot;$@\&quot;&quot;){ //don't intentionally make a broken script.
     Glib::ustring command = &quot;#! /bin/sh\nexec &quot; + musicentry-&gt;get_text() + &quot;\n&quot;;
     try {
-      Glib::ustring exec1 = (getenv(&quot;HOME&quot;) +  (Glib::ustring)(choicesdir + &quot;/MIME-types/audio&quot;));
+      Glib::ustring exec1 = (Glib::get_home_dir() +  (Glib::ustring)(choicesdir + &quot;/MIME-types/audio&quot;));
       Gnome::Vfs::Handle write_handle;
       write_handle.create(exec1, Gnome::Vfs::OPEN_WRITE, false, 0755);
       write_handle.seek(Gnome::Vfs::SEEK_POS_START, 0);
@@ -119,7 +121,7 @@
   if ( videoentry-&gt;get_text() != &quot;* \&quot;$@\&quot;&quot;){ //don't intentionally make a broken script.
     Glib::ustring command = &quot;#! /bin/sh\nexec &quot; + videoentry-&gt;get_text() + &quot;\n&quot;;
     try {
-      Glib::ustring exec1 = (getenv(&quot;HOME&quot;) +  (Glib::ustring)(choicesdir + &quot;/MIME-types/video&quot;));
+      Glib::ustring exec1 = (Glib::get_home_dir() +  (Glib::ustring)(choicesdir + &quot;/MIME-types/video&quot;));
       Gnome::Vfs::Handle write_handle;
       write_handle.create(exec1, Gnome::Vfs::OPEN_WRITE, false, 0755);
       write_handle.seek(Gnome::Vfs::SEEK_POS_START, 0);
@@ -131,7 +133,7 @@
   if ( imageentry-&gt;get_text() != &quot;* \&quot;$@\&quot;&quot;){ //don't intentionally make a broken script.
     Glib::ustring command = &quot;#! /bin/sh\nexec &quot; + imageentry-&gt;get_text() + &quot;\n&quot;;
     try {
-      Glib::ustring exec1 = (getenv(&quot;HOME&quot;) +  (Glib::ustring)(choicesdir + &quot;/MIME-types/image&quot;));
+      Glib::ustring exec1 = (Glib::get_home_dir() +  (Glib::ustring)(choicesdir + &quot;/MIME-types/image&quot;));
       Gnome::Vfs::Handle write_handle;
       write_handle.create(exec1, Gnome::Vfs::OPEN_WRITE, false, 0755);
       write_handle.seek(Gnome::Vfs::SEEK_POS_START, 0);

Modified: trunk/src/firsttime.h
===================================================================
--- trunk/src/firsttime.h	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/firsttime.h	2005-05-14 17:18:39 UTC (rev 72)
@@ -4,14 +4,6 @@
 #define FIRSTTIME_H
 
 #include &quot;main.h&quot;
-#include &lt;gtkmm/dialog.h&gt;
-#include &lt;gtkmm/button.h&gt;
-#include &lt;gtkmm/buttonbox.h&gt;
-#include &lt;gtkmm/image.h&gt;
-#include &lt;gtkmm/label.h&gt;
-#include &lt;gtkmm/box.h&gt;
-#include &lt;gtkmm/entry.h&gt;
-#include &lt;gtkmm/table.h&gt;
 
 /**********************/
 

Modified: trunk/src/iconmodes.cpp
===================================================================
--- trunk/src/iconmodes.cpp	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/iconmodes.cpp	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,5 +1,7 @@
 /* Darimasen - iconmodes.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
 
+/**********************/
+
 #include &quot;iconmodes.h&quot;
 
 /**********************/
@@ -27,7 +29,7 @@
 
 //check the choices dir
 Glib::ustring choicesdir = getchoicesdir();
-Glib::ustring exec = getenv(&quot;HOME&quot;);
+Glib::ustring exec = Glib::get_home_dir();
   try{
     exec += choicesdir;
     exec += &quot;/MIME-types/&quot;;
@@ -38,7 +40,7 @@
     exec += &quot; \&quot;&quot;  + path + FileName + &quot;\&quot;&quot;;
     goruncommand(exec,path);
 
-    parent-&gt;parent-&gt;set_message(exec + &quot; was run.&quot;);
+    parent-&gt;parent-&gt;set_message(FileName + &quot; was run as &quot; + FileMime);
     return;
 
     }
@@ -52,7 +54,7 @@
     exec += &quot; \&quot;&quot;  + path + FileName + &quot;\&quot;&quot;;
     goruncommand(exec,path);
 
-    parent-&gt;parent-&gt;set_message(exec + &quot; was run.&quot;);
+    parent-&gt;parent-&gt;set_message(FileName + &quot; was run as &quot; + FileMime.substr(0,FileMime.find(&quot;/&quot;)));
     return;
     }
   catch(const Gnome::Vfs::exception&amp; ex){
@@ -77,12 +79,12 @@
   switch(dialog.run()) {
     case(Gtk::RESPONSE_OK):
       {
-        Glib::ustring exec = getenv(&quot;HOME&quot;);
+        Glib::ustring exec = Glib::get_home_dir();
 	exec += choicesdir;
         exec += &quot;/MIME-types/text&quot;;
         exec += &quot; \&quot;&quot;  + path + FileName + &quot;\&quot;&quot;;
         Glib::spawn_command_line_async(exec);
-        parent-&gt;parent-&gt;set_message(exec + &quot; was opened as a text file.&quot;);
+        parent-&gt;parent-&gt;set_message(FileName + &quot; was run as a text file.&quot;);
         return;
         }
       break;
@@ -111,7 +113,7 @@
 
   Glib::ustring choicesdir = getchoicesdir();
   Gnome::Vfs::Handle exec_handle;
-  Glib::ustring exec = getenv(&quot;HOME&quot;);
+  Glib::ustring exec = Glib::get_home_dir();
   try{
     exec += choicesdir;
     exec += &quot;/MIME-types/text&quot;;
@@ -119,7 +121,7 @@
     exec += &quot; \&quot;&quot;  + path + FileName + &quot;\&quot;&quot;;
     Glib::spawn_command_line_async(exec);
 
-    parent-&gt;parent-&gt;set_message(exec + &quot; was run.&quot;);
+    parent-&gt;parent-&gt;set_message(exec + &quot; was run as text&quot;);
     return;
     }
   catch(const Gnome::Vfs::exception&amp; ex){}
@@ -249,9 +251,8 @@
   path = getPath;
   parent = &getParent;
 
-  Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; x = Gnome::Vfs::Uri::create(
-    getPath + &quot;.DirIcon&quot;);
-  if (x-&gt;uri_exists()){
+  Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; x = Gnome::Vfs::Uri::create( getPath + &quot;.DirIcon&quot;);
+  if (x-&gt;uri_exists() &amp;&amp; Glib::str_has_suffix(getPath,getFile-&gt;get_name() + slash)){
     icon = Gdk::Pixbuf::create_from_file(getPath + &quot;.DirIcon&quot;);
     FileMime = &quot;AppDir&quot;;
     }
@@ -433,9 +434,9 @@
 
 void DaIconModes::ChooseActionDialogue::GetCurrentAction(Glib::ustring mimeType){
 
-  Glib::ustring choicesdir = getchoicesdir();
-  Glib::ustring contents, exec1 = getenv(&quot;HOME&quot;);
-  exec1 += choicesdir;
+  //Glib::ustring choicesdir = getchoicesdir();
+  Glib::ustring contents, exec1 = Glib::get_home_dir();
+  exec1 += getchoicesdir();
   exec1 += (Glib::ustring)(&quot;/MIME-types/&quot;);
   exec1 += mimeType;
 
@@ -467,7 +468,7 @@
     command += &quot;\n&quot;;
 
     try {
-      Glib::ustring exec1 = getenv(&quot;HOME&quot;);
+      Glib::ustring exec1 = Glib::get_home_dir();
       Glib::ustring choicesdir = getchoicesdir();
       exec1 += choicesdir;
       exec1 += (Glib::ustring)(&quot;/MIME-types/&quot;);
@@ -705,7 +706,6 @@
     Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; x = Gnome::Vfs::Uri::create(
       parent-&gt;get_history(position) + info-&gt;get_name() + slash + &quot;.DirIcon&quot;);
       if (x-&gt;uri_exists()){
-        //std::cout&lt;&lt; x-&gt;get_path() &lt;&lt; &quot;\n&quot;;
         iconlist[slotsUsed++] = new proto_icon(
           *this, parent-&gt;get_history(position) + info-&gt;get_name() + slash, info);
         }
@@ -755,12 +755,20 @@
       switch(mode){
         case 0: {
           Sidecon * tmpSidecon = new Sidecon(*iconlist[i]);
-          DisposableTable-&gt;attach( *tmpSidecon, x_pos, x_pos+1, y_pos, y_pos+1,Gtk::FILL, Gtk::FILL, 4, 4);
+          Gtk::Alignment * alignment1 = Gtk::manage(
+            new class Gtk::Alignment(Gtk::ALIGN_LEFT, Gtk::ALIGN_CENTER, 0, 0));
+          alignment1-&gt;add(*tmpSidecon);
+          DisposableTable-&gt;attach( *alignment1, x_pos, x_pos+1, y_pos, y_pos+1,
+            Gtk::FILL, Gtk::FILL , 4, 4);
             }
           break;
         case 1: {
           Listview * tmpListview = new Listview(*iconlist[i]);
-          DisposableTable-&gt;attach( *tmpListview, x_pos, x_pos+1, y_pos, y_pos+1,Gtk::FILL, Gtk::FILL, 4, 4);
+          Gtk::Alignment * alignment1 = Gtk::manage(
+            new class Gtk::Alignment(Gtk::ALIGN_LEFT, Gtk::ALIGN_CENTER, 0, 0));
+          alignment1-&gt;add(*tmpListview);
+          DisposableTable-&gt;attach( *alignment1, x_pos, x_pos+1, y_pos, y_pos+1,
+            Gtk::FILL, Gtk::FILL, 4, 4);
             }
           break;
         }

Modified: trunk/src/iconmodes.h
===================================================================
--- trunk/src/iconmodes.h	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/iconmodes.h	2005-05-14 17:18:39 UTC (rev 72)
@@ -4,13 +4,8 @@
 #define ICONMODES_H
 
 
+#include &quot;main.h&quot;
 #include &quot;darimasen.h&quot;
-#include &lt;libgnomevfsmm.h&gt;
-#include &lt;gtkmm/table.h&gt;
-#include &lt;gdkmm/pixbuf.h&gt;
-#include &lt;gtkmm/entry.h&gt;
-#include &lt;gtkmm/messagedialog.h&gt;
-#include &lt;gtkmm/separator.h&gt;
 
 /**********************/
 

Modified: trunk/src/main.cpp
===================================================================
--- trunk/src/main.cpp	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/main.cpp	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,9 +1,12 @@
- /* Darimasen - main.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
+/* Darimasen - main.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
    
+/**********************/
   
 #include &quot;main.h&quot;
+
 #include &quot;firsttime.h&quot;
-  
+#include &quot;darimasen.h&quot;
+
 /**********************/
   
 int main(int argc, char *argv[])
@@ -13,7 +16,7 @@
 
   // check for mime definitions. 
   { 
-    Glib::ustring fuz = getenv(&quot;HOME&quot;) ;
+    Glib::ustring fuz = Glib::get_home_dir() ;
     Glib::ustring altfuz = fuz;
     fuz += &quot;/Choices&quot;;
     Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; fuzz = Gnome::Vfs::Uri::create(fuz);
@@ -30,20 +33,25 @@
     //check which choices dir to use, use .choices if Choices isn't there      
     if (!fuzz-&gt;uri_exists()){
    	fuz = altfuz;
-        
     }
 
-   fuz += &quot;/MIME-types&quot;;
-   Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; fuz2 = Gnome::Vfs::Uri::create(fuz);
+   // make actions folder if needed
+   Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; fuz2 = Gnome::Vfs::Uri::create(fuz + &quot;/MIME-types&quot;);
     if (!fuz2-&gt;uri_exists()){
-      gnome_vfs_make_directory(fuz.c_str(),493);
-      dialog1_glade window;
+      gnome_vfs_make_directory((fuz + &quot;/MIME-types&quot;).c_str(),493);
+      dialog1_glade window; 
       Gtk::Main::run(window); 
       }
+    
+
+   // make our own settings folder if needed
+   Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; fuz3 = Gnome::Vfs::Uri::create(fuz + &quot;/Darimasen&quot;);
+    if (!fuz3-&gt;uri_exists()){
+      gnome_vfs_make_directory((fuz + &quot;/Darimasen&quot;).c_str(),493);
+      }
     }
 
 
-
   std::vector&lt;Glib::ustring&gt; path;
 
   for( int i=1; i &lt; argc; i++){
@@ -80,12 +88,9 @@
     }
 
   if(path.empty())
-  #ifdef WIN32
-  path.push_back(getenv(&quot;USERPROFILE&quot;) + slash);
-  #else
-  path.push_back(getenv(&quot;HOME&quot;) + slash);
-  #endif
+    path.push_back(Glib::get_home_dir() + slash);
 
+
   std::cout &lt;&lt; &quot;Tabs opened should be for:\n&quot;;
   for(int i =0; i&lt; path.size();i++)
       std::cout &lt;&lt; path[i] &lt;&lt;  &quot;\n&quot;;

Modified: trunk/src/main.h
===================================================================
--- trunk/src/main.h	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/main.h	2005-05-14 17:18:39 UTC (rev 72)
@@ -5,12 +5,20 @@
 
 /**********************/
 
-#include &lt;gtkmm/main.h&gt;
-#include &lt;glibmm/ustring.h&gt;
+#include &lt;vector&gt;
+#include &lt;iostream&gt;
 #include &lt;libgnomevfsmm.h&gt;
-#include &lt;vector&gt;
+#include &lt;gtkmm.h&gt;
+
+#include &quot;supplimental.h&quot;
+
+/**********************
+
 #include &quot;darimasen.h&quot;
-
+#include &quot;optionsManager.h&quot;
+#include &quot;supplimental.h&quot;
+#include &quot;iconmodes.h&quot;
+#include &quot;damenu.h&quot;
 /**********************/
 
 #ifdef WIN32

Added: trunk/src/optionsManager.cpp
===================================================================
--- trunk/src/optionsManager.cpp	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/optionsManager.cpp	2005-05-14 17:18:39 UTC (rev 72)
@@ -0,0 +1,57 @@
+/* Darimasen - optionsManager.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
+
+/**********************/
+
+#include &quot;optionsManager.h&quot;
+
+/**********************/
+
+void optionsQuery::DumpParser::on_start_element(Glib::Markup::ParseContext&amp;,
+                                  const Glib::ustring&amp;,
+                                  const AttributeMap&amp;  attributes){
+  for(AttributeMap::const_iterator p = attributes.begin(); p != attributes.end(); ++p){
+    std::cout &lt;&lt;  p-&gt;second ;
+    }
+  }
+
+/**********************/
+
+void optionsQuery::DumpParser::on_text(Glib::Markup::ParseContext&amp;, const Glib::ustring&amp; text){
+  Glib::ustring trimmed_text = trim_whitespace(text);
+  if (!trimmed_text.empty()) std::cout &lt;&lt; &quot; &quot; &lt;&lt; trimmed_text &lt;&lt; &quot;\n&quot;;
+  }
+
+/**********************/ 
+
+// get the contents out of one of our XML settings files
+optionsQuery::optionsQuery(Glib::ustring toParse){
+
+  DumpParser parser;
+  Glib::Markup::ParseContext context (parser);
+
+  try{
+    context.parse(Glib::file_get_contents(toParse));
+    context.end_parse();
+    }
+  catch(const Glib::Error) {
+    std::cout&lt;&lt; &quot;Error! Settings file &quot; &lt;&lt; toParse &lt;&lt; &quot; not found.\n&quot;;
+    }
+  }
+
+/**********************/ 
+
+// write out to file
+optionsQuery::~optionsQuery(){
+  }
+
+/**********************/ 
+
+//set values in out vectors
+  bool optionsQuery::set_option(Glib::ustring, Glib::ustring){}
+
+/**********************/ 
+
+//return set values
+  Glib::ustring optionsQuery::get_option(Glib::ustring){}
+
+/**********************/ 

Added: trunk/src/optionsManager.h
===================================================================
--- trunk/src/optionsManager.h	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/optionsManager.h	2005-05-14 17:18:39 UTC (rev 72)
@@ -0,0 +1,46 @@
+/* Darimasen - optionsManager.h - Copyright (C) 2004 - 2005 Sudrien, GPL */
+
+#ifndef OPTIONS_H
+#define OPTIONS_H
+
+/**********************/
+
+#include &quot;main.h&quot;
+
+/**********************/
+
+Glib::ustring int2ustr(int);
+Glib::ustring underscoreSafe(Glib::ustring);
+Glib::ustring getchoicesdir();
+void goruncommand(Glib::ustring, Glib::ustring);
+Glib::ustring trim_whitespace(const Glib::ustring&amp;);
+/**********************/
+
+class optionsQuery{
+
+
+  class DumpParser : public Glib::Markup::Parser {
+    void on_start_element(Glib::Markup::ParseContext&amp;, const Glib::ustring&amp;, const AttributeMap&amp;);
+    void on_text(Glib::Markup::ParseContext&amp; context, const Glib::ustring&amp; text);
+    };
+
+  struct optionholder {
+    Glib::ustring name;
+    Glib::ustring value;
+    };
+
+  std::vector&lt;optionholder&gt; optionVector;
+  
+  public:
+
+  optionsQuery(Glib::ustring);
+  ~optionsQuery();
+
+  bool set_option(Glib::ustring, Glib::ustring);
+
+  Glib::ustring get_option(Glib::ustring);
+  };
+
+/**********************/
+
+#endif //SUPPLIMENTAL_H

Modified: trunk/src/supplimental.cpp
===================================================================
--- trunk/src/supplimental.cpp	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/supplimental.cpp	2005-05-14 17:18:39 UTC (rev 72)
@@ -1,7 +1,8 @@
 /* Darimasen - supplimental.cpp - Copyright (C) 2004 - 2005 Sudrien, GPL */
+
+/**********************/
 
-#include &quot;supplimental.h&quot;
-
+#include &quot;supplimental.h&quot;
 /**********************/
 
 Glib::ustring int2ustr(int x){
@@ -34,21 +35,33 @@
 
 //check which choices dir to use
 Glib::ustring getchoicesdir(){
-  Glib::RefPtr&lt;Gnome::Vfs::Uri&gt; choicespath = Gnome::Vfs::Uri::create(
-    (Glib::ustring)getenv(&quot;HOME&quot;) + &quot;/Choices&quot;);
-  if (choicespath-&gt;uri_exists()){
-    return &quot;/Choices&quot;;
-    }
-  return &quot;/.choices&quot;;
+  if (Gnome::Vfs::Uri::create(Glib::get_home_dir() + &quot;/Choices&quot;)-&gt;uri_exists()) return &quot;/Choices&quot;;
+  else return &quot;/.choices&quot;;
   }
 
 /**********************/
 
+//execute a command in the correct working directory
 void goruncommand(Glib::ustring exec, Glib::ustring path){
-//execute a command in the correct working directory
-    Glib::ArrayHandle&lt;std::string&gt; cmd_args = Glib::shell_parse_argv(exec);
-    Glib::spawn_async(path, cmd_args, Glib::SPAWN_SEARCH_PATH);
-
+    Glib::spawn_async(path, Glib::shell_parse_argv(exec), Glib::SPAWN_SEARCH_PATH);
   }
   
+/**********************/
+
+Glib::ustring trim_whitespace(const Glib::ustring&amp; text)
+{
+  Glib::ustring::const_iterator pbegin (text.begin());
+  Glib::ustring::const_iterator pend   (text.end());
+
+  while(pbegin != pend &amp;&amp; Glib::Unicode::isspace(*pbegin))
+    ++pbegin;
+
+  Glib::ustring::const_iterator temp (pend);
+
+  while(pbegin != temp &amp;&amp; Glib::Unicode::isspace(*--temp))
+    pend = temp;
+
+  return Glib::ustring(pbegin, pend);
+}
+
 /**********************/ 

Modified: trunk/src/supplimental.h
===================================================================
--- trunk/src/supplimental.h	2005-05-09 11:07:36 UTC (rev 71)
+++ trunk/src/supplimental.h	2005-05-14 17:18:39 UTC (rev 72)
@@ -5,8 +5,7 @@
 
 /**********************/
 
-#include &quot;main.h&quot;
-#include &lt;iostream&gt;
+#include &quot;main.h&quot;
 
 /**********************/
 
@@ -14,7 +13,8 @@
 Glib::ustring underscoreSafe(Glib::ustring);
 Glib::ustring getchoicesdir();
 void goruncommand(Glib::ustring, Glib::ustring);
-
+Glib::ustring trim_whitespace(const Glib::ustring&amp;);
+
 /**********************/
 
 #endif //SUPPLIMENTAL_H


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000021.html">[Darimasen-svn] r71 - trunk/src
</A></li>
	<LI>Next message: <A HREF="000023.html">[Darimasen-svn] r74 - trunk/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#22">[ date ]</a>
              <a href="thread.html#22">[ thread ]</a>
              <a href="subject.html#22">[ subject ]</a>
              <a href="author.html#22">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/darimasen-svn">More information about the Darimasen-svn
mailing list</a><br>
</body></html>
